{
	"tasks": [
		{
			"id": "task_6988",
			"reference": {
				"name": "retrieve",
				"package": {
					"name": "@criticalmanufacturing/connect-iot-controller-engine-core-tasks",
					"version": "8.3.3-202201212"
				}
			},
			"settings": {
				"_retrieveOnValueChange": false,
				"_emitInNewContext": false,
				"_outputs": [
					{
						"name": "Resource",
						"identifier": "Generic_ResourceName",
						"defaultValue": "-",
						"valueType": {
							"name": "",
							"friendlyName": "",
							"type": 4,
							"collectionType": 0,
							"referenceType": null,
							"referenceTypeName": null
						}
					}
				],
				"___cmf___name": "Retrieve Data",
				"___cmf___color": "#c0c0c0"
			}
		},
		{
			"id": "task_127417",
			"reference": {
				"name": "workflow",
				"package": {
					"name": "@criticalmanufacturing/connect-iot-controller-engine-core-tasks",
					"version": "8.3.3-202201212"
				}
			},
			"settings": {
				"automationWorkflow": {
					"DisplayName": "ProcessComplete",
					"IsShared": true,
					"Name": "ProcessComplete"
				},
				"executeWhenAllInputsDefined": false,
				"contextsExpirationInMilliseconds": 60000,
				"executionExpirationInMilliseconds": 1200000,
				"inputs": [
					{
						"name": "MaterialName",
						"valueType": {
							"type": 4,
							"collectionType": 0,
							"referenceType": null,
							"referenceTypeName": null,
							"referenceTypeId": null,
							"friendlyName": "MaterialName"
						}
					},
					{
						"name": "ContainerName",
						"valueType": {
							"type": 4,
							"collectionType": 0,
							"referenceType": null,
							"referenceTypeName": null,
							"referenceTypeId": null,
							"friendlyName": "ContainerName"
						}
					},
					{
						"name": "LoadPortId",
						"valueType": {
							"type": 5,
							"collectionType": 0,
							"referenceType": null,
							"referenceTypeName": null,
							"referenceTypeId": null,
							"friendlyName": "LoadPortId"
						}
					},
					{
						"name": "IsBatchAction",
						"valueType": {
							"type": 3,
							"collectionType": 0,
							"referenceType": null,
							"referenceTypeName": null,
							"referenceTypeId": null,
							"friendlyName": "IsBatchAction"
						}
					},
					{
						"name": "DoNotTriggerMaterialOut",
						"valueType": {
							"type": 3,
							"collectionType": 0,
							"referenceType": null,
							"referenceTypeName": null,
							"referenceTypeId": null,
							"friendlyName": ""
						}
					},
					{
						"name": "StateUpdatedOnMainEquipment",
						"valueType": {
							"type": 3,
							"collectionType": 0,
							"referenceType": null,
							"referenceTypeName": null,
							"referenceTypeId": null,
							"friendlyName": ""
						}
					}
				],
				"outputs": [
					{
						"name": "MaterialDataObjects",
						"valueType": {
							"friendlyName": "MaterialDataObjects",
							"type": 10,
							"collectionType": 0,
							"referenceType": null,
							"referenceTypeName": null,
							"referenceTypeId": null
						}
					}
				],
				"___cmf___name": "Process Complete Workflow"
			}
		},
		{
			"id": "task_75124",
			"reference": {
				"name": "equipmentEvent",
				"package": {
					"name": "@criticalmanufacturing/connect-iot-controller-engine-core-tasks",
					"version": "8.3.3-202201212"
				}
			},
			"settings": {
				"_workingMode": "AlwaysActive",
				"_acceptAllEvents": false,
				"_outputs": [
					{
						"property": {
							"$type": "Cmf.Foundation.BusinessObjects.AutomationProperty, Cmf.Foundation.BusinessObjects",
							"Name": "CtrlJobID",
							"DataType": 0
						},
						"outputType": "Value"
					}
				],
				"___cmf___name": "On Equipment Event",
				"_events": [
					{
						"$type": "Cmf.Foundation.BusinessObjects.AutomationEvent, Cmf.Foundation.BusinessObjects",
						"Name": "ControlJob:10:Executing-Completed"
					}
				]
			},
			"driver": "SecsGemEquipment"
		},
		{
			"id": "task_83099",
			"reference": {
				"name": "codeExecution",
				"package": {
					"name": "@criticalmanufacturing/connect-iot-controller-engine-core-tasks",
					"version": "8.3.3-202201212"
				}
			},
			"settings": {
				"tsCode": [
					"import { Framework } from 'framework';",
					"",
					"export default class {",
					"",
					"    /** Allows accessing external functions */",
					"    private framework: Framework;",
					"",
					"    constructor(framework: Framework) {",
					"        this.framework = framework;",
					"    }",
					"",
					"    /*",
					"     * Entry point of the class (IMPORTANT: don't change the signature of this method)",
					"     * Should return an object containing the values for each output to emit",
					"     * If necessary, use the parameter \"outputs\" to emit data while running the code.",
					"     */",
					"    public async main(inputs: any, outputs: any): Promise<any> {",
					"        // Add code here",
					"        const ctrlJobID = inputs.CtrlJobID;",
					"        let materialName = ctrlJobID.replace(\"CtrlJob_\", \"\");",
					"        // emit output during execution: outputs.output1.emit(\"something\");",
					"        return { MaterialName: materialName};",
					"    }",
					"}",
					""
				],
				"jsCodeBase64": "T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsNCmNsYXNzIGRlZmF1bHRfMSB7DQogICAgY29uc3RydWN0b3IoZnJhbWV3b3JrKSB7DQogICAgICAgIHRoaXMuZnJhbWV3b3JrID0gZnJhbWV3b3JrOw0KICAgIH0NCiAgICAvKg0KICAgICAqIEVudHJ5IHBvaW50IG9mIHRoZSBjbGFzcyAoSU1QT1JUQU5UOiBkb24ndCBjaGFuZ2UgdGhlIHNpZ25hdHVyZSBvZiB0aGlzIG1ldGhvZCkNCiAgICAgKiBTaG91bGQgcmV0dXJuIGFuIG9iamVjdCBjb250YWluaW5nIHRoZSB2YWx1ZXMgZm9yIGVhY2ggb3V0cHV0IHRvIGVtaXQNCiAgICAgKiBJZiBuZWNlc3NhcnksIHVzZSB0aGUgcGFyYW1ldGVyICJvdXRwdXRzIiB0byBlbWl0IGRhdGEgd2hpbGUgcnVubmluZyB0aGUgY29kZS4NCiAgICAgKi8NCiAgICBhc3luYyBtYWluKGlucHV0cywgb3V0cHV0cykgew0KICAgICAgICAvLyBBZGQgY29kZSBoZXJlDQogICAgICAgIGNvbnN0IGN0cmxKb2JJRCA9IGlucHV0cy5DdHJsSm9iSUQ7DQogICAgICAgIGxldCBtYXRlcmlhbE5hbWUgPSBjdHJsSm9iSUQucmVwbGFjZSgiQ3RybEpvYl8iLCAiIik7DQogICAgICAgIC8vIGVtaXQgb3V0cHV0IGR1cmluZyBleGVjdXRpb246IG91dHB1dHMub3V0cHV0MS5lbWl0KCJzb21ldGhpbmciKTsNCiAgICAgICAgcmV0dXJuIHsgTWF0ZXJpYWxOYW1lOiBtYXRlcmlhbE5hbWUgfTsNCiAgICB9DQp9DQpleHBvcnRzLmRlZmF1bHQgPSBkZWZhdWx0XzE7DQo=",
				"inputs": [
					{
						"name": "CtrlJobID",
						"valueType": {
							"type": 4,
							"collectionType": 0,
							"referenceType": null,
							"referenceTypeName": null,
							"referenceTypeId": null,
							"friendlyName": "CtrlJobID"
						}
					}
				],
				"outputs": [
					{
						"name": "MaterialName",
						"valueType": {
							"friendlyName": "MaterialName",
							"type": 4,
							"collectionType": 0,
							"referenceType": null,
							"referenceTypeName": null,
							"referenceTypeId": null
						}
					}
				],
				"contextExpirationInMilliseconds": 10000,
				"executionExpirationInMilliseconds": 0,
				"___cmf___name": "Code"
			}
		}
	],
	"converters": [
		{
			"id": "@criticalmanufacturing/connect-iot-controller-engine-core-tasks#anyToAny",
			"reference": {
				"name": "anyToAny",
				"package": {
					"name": "@criticalmanufacturing/connect-iot-controller-engine-core-tasks",
					"version": "8.3.3-202201212"
				}
			}
		},
		{
			"id": "@criticalmanufacturing/connect-iot-controller-engine-core-tasks#stringToEntityInstance",
			"reference": {
				"name": "stringToEntityInstance",
				"package": {
					"name": "@criticalmanufacturing/connect-iot-controller-engine-core-tasks",
					"version": "8.3.3-202201212"
				}
			}
		},
		{
			"id": "@criticalmanufacturing/connect-iot-controller-engine-core-tasks#objectProperty",
			"reference": {
				"name": "objectProperty",
				"package": {
					"name": "@criticalmanufacturing/connect-iot-controller-engine-core-tasks",
					"version": "8.3.3-202201212"
				}
			}
		},
		{
			"id": "@criticalmanufacturing/connect-iot-controller-engine-core-tasks#anyToConstant",
			"reference": {
				"name": "anyToConstant",
				"package": {
					"name": "@criticalmanufacturing/connect-iot-controller-engine-core-tasks",
					"version": "8.3.3-202201212"
				}
			}
		}
	],
	"links": [
		{
			"id": "10cfc684-360e-45d3-9e0d-864ea420908d",
			"sourceId": "task_83099",
			"targetId": "task_127417",
			"inputName": "MaterialNameIn",
			"outputName": "MaterialNameOut"
		},
		{
			"id": "25b26753-30ad-4540-bade-ec8e36da2135",
			"sourceId": "task_83099",
			"targetId": "task_127417",
			"inputName": "activate",
			"outputName": "MaterialNameOut"
		},
		{
			"id": "3b1c61b4-6fc7-4717-80f9-59285ce40590",
			"sourceId": "task_75124",
			"targetId": "task_83099",
			"inputName": "activate",
			"outputName": "$CtrlJobID"
		},
		{
			"id": "f1e9e116-d166-4655-af24-679cc7f5d2eb",
			"sourceId": "task_75124",
			"targetId": "task_83099",
			"inputName": "CtrlJobIDIn",
			"outputName": "$CtrlJobID"
		}
	],
	"layout": {
		"general": {
			"color": "#00ff80",
			"notes": [
				{
					"id": "note_60654",
					"name": "TosProcessComplete",
					"value": "<p><strong>What it does:</strong></p><p>Updates MaterialData state from Setup to Complete.</p><p>Updates MES Material CustomMaterialStateModel state (Main State Model State) to Complete.</p><p>Executes Material Out.</p><p><strong>How to use it:</strong></p><ol><li>Open the Event task and select the Event corresponding to TosProcessComplete for the Tool;</li><li>Use the information received to drive the Process Complete workflow;</li><li>Pass any event Output to the Activate Input of the Workflow;</li></ol><p><strong>Note:</strong><strong></strong></p><p>The Workflow Process Complete will try to retrieve the MaterialData using the inputs following the next logic:</p><ol><li>If the materialName is available retrieve the corresponding materialData;</li><li>If the containerName is available retrieve the materialData which references it on containerName;</li><li>If the loadPortId is passed it will use a match using load port id and materialState defined on the settings;</li><li>If no information is available on the inputs, if defined, use the materialState defined on the settings to retrieve the first (oldest) materialData available in the persistence;</li><li>If none of this criteria corresponds to available information, return an error.</li></ol><p>The logic described before will be triggered by order, but only one the first matching selection criteria will be run. If the criteria fails to return a materialData an Error will be returned.<br /><br />If a material is found, then it sets its state to the state defined in the setting parameter Material To Set, update the materialData on persistence. When successful output the updated materialData on the output material.</p><p>If IsBatch input is passed as True all the MaterialData that match the inputs, and corresponding Material on MES, will be set to the new state and Material Out executed, if not passed or passed as False only the first one will be actuated.&nbsp;</p>",
					"color": "#ffffa5"
				}
			]
		},
		"drawers": {
			"DIAGRAM": {
				"tasks": {
					"task_6988": {
						"collapsed": false,
						"position": {
							"x": 1608,
							"y": 1909
						},
						"outdated": false
					},
					"task_127417": {
						"collapsed": false,
						"position": {
							"x": 1288,
							"y": 281
						},
						"outdated": false
					},
					"task_75124": {
						"collapsed": false,
						"position": {
							"x": 150,
							"y": 338
						},
						"outdated": false
					},
					"task_83099": {
						"collapsed": false,
						"position": {
							"x": 714,
							"y": 419
						},
						"outdated": false
					}
				},
				"links": {
					"10cfc684-360e-45d3-9e0d-864ea420908d": {
						"vertices": []
					},
					"25b26753-30ad-4540-bade-ec8e36da2135": {
						"vertices": []
					},
					"3b1c61b4-6fc7-4717-80f9-59285ce40590": {
						"vertices": []
					},
					"f1e9e116-d166-4655-af24-679cc7f5d2eb": {
						"vertices": []
					}
				},
				"notes": {
					"note_60654": {
						"collapsed": false,
						"position": {
							"x": 1945,
							"y": 55
						}
					}
				},
				"zoom": 0.7800000000000005,
				"pan": {
					"x": 332.1322410472169,
					"y": 9.631775319590872
				}
			}
		}
	}
}