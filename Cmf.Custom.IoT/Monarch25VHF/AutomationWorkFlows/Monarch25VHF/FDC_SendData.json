{
  "tasks": [
    {
      "id": "task_123431",
      "reference": {
        "name": "subWorkflowEnd",
        "package": {
          "name": "@criticalmanufacturing/connect-iot-controller-engine-core-tasks",
          "version": "9.1.0-202209072"
        }
      },
      "settings": {
        "inputs": [],
        "___cmf___name": "End"
      }
    },
    {
      "id": "task_123433",
      "reference": {
        "name": "subWorkflowStart",
        "package": {
          "name": "@criticalmanufacturing/connect-iot-controller-engine-core-tasks",
          "version": "9.1.0-202209072"
        }
      },
      "settings": {
        "outputs": [
          {
            "name": "MaterialName",
            "valueType": {
              "type": 4,
              "collectionType": 0,
              "referenceType": null,
              "referenceTypeName": null,
              "referenceTypeId": null,
              "friendlyName": "Material Name"
            },
            "defaultValue": null
          },
          {
            "name": "Resource",
            "valueType": {
              "type": 4,
              "collectionType": 0,
              "referenceType": null,
              "referenceTypeName": null,
              "referenceTypeId": null,
              "friendlyName": ""
            },
            "defaultValue": null
          },
          {
            "name": "FDCAction",
            "valueType": null
          },
          {
            "name": "CEID",
            "valueType": {
              "type": 4,
              "collectionType": 0,
              "referenceType": null,
              "referenceTypeName": null,
              "referenceTypeId": null,
              "friendlyName": ""
            },
            "defaultValue": null
          }
        ],
        "___cmf___name": "Start"
      }
    },
    {
      "id": "task_123435",
      "reference": {
        "name": "workflow",
        "package": {
          "name": "@criticalmanufacturing/connect-iot-controller-engine-core-tasks",
          "version": "9.1.0-202209072"
        }
      },
      "settings": {
        "automationWorkflow": {},
        "executeWhenAllInputsDefined": false,
        "contextsExpirationInMilliseconds": 60000,
        "executionExpirationInMilliseconds": 1200000,
        "inputs": [
          {
            "name": "FDCMaterial",
            "valueType": {
              "type": 4,
              "collectionType": 0,
              "referenceType": null,
              "referenceTypeName": null,
              "referenceTypeId": null,
              "friendlyName": ""
            }
          },
          {
            "name": "Resource",
            "valueType": {
              "type": 4,
              "collectionType": 0,
              "referenceType": null,
              "referenceTypeName": null,
              "referenceTypeId": null,
              "friendlyName": ""
            }
          },
          {
            "name": "FDCAction",
            "valueType": {
              "type": 5,
              "collectionType": 0,
              "referenceType": null,
              "referenceTypeName": null,
              "referenceTypeId": null,
              "friendlyName": ""
            }
          },
          {
            "name": "CEID",
            "valueType": {
              "type": 4,
              "collectionType": 0,
              "referenceType": null,
              "referenceTypeName": null,
              "referenceTypeId": null,
              "friendlyName": ""
            }
          }
        ],
        "outputs": [
          {
            "name": "ServiceName",
            "valueType": {
              "type": 4,
              "collectionType": 0,
              "referenceType": null,
              "referenceTypeName": null,
              "referenceTypeId": null,
              "friendlyName": ""
            }
          },
          {
            "name": "Message",
            "valueType": {
              "type": 10,
              "collectionType": 0,
              "referenceType": null,
              "referenceTypeName": null,
              "referenceTypeId": null,
              "friendlyName": ""
            }
          },
          {
            "name": "Timeout",
            "valueType": {
              "type": 4,
              "collectionType": 0,
              "referenceType": null,
              "referenceTypeName": null,
              "referenceTypeId": null,
              "friendlyName": ""
            }
          }
        ],
        "___cmf___name": "Get FDC Data"
      }
    },
    {
      "id": "task_123437",
      "reference": {
        "name": "codeExecution",
        "package": {
          "name": "@criticalmanufacturing/connect-iot-controller-engine-core-tasks",
          "version": "9.1.0-202209072"
        }
      },
      "settings": {
        "tsCode": [
          "import { Framework } from 'framework';",
          "",
          "export default class {",
          "",
          "    /** Allows accessing external functions */",
          "    private framework: Framework;",
          "",
          "    constructor(framework: Framework) {",
          "        this.framework = framework;",
          "    }",
          "",
          "    /*",
          "     * Entry point of the class (IMPORTANT: don't change the signature of this method)",
          "     * Should return an object containing the values for each output to emit",
          "     * If necessary, use the parameter \"outputs\" to emit data while running the code.",
          "     */",
          "    public async main(inputs: any, outputs: any): Promise<any> {",
          "        //Add code here",
          "        const service = inputs.ServiceName;",
          "        const timeout = inputs.Timeout;",
          "        const message = inputs.Message;",
          "",
          "        let x = 0;",
          "        this.framework.logger.warning(service);",
          "        const remoteCommandSuccessCode = \"timeout=true\";",
          "        let commandParameters: any[] = [];",
          "",
          "        for(x=0; x < message.length; x++)",
          "        {",
          "            commandParameters = [];",
          "            let sendMessage: Object = {",
          "",
          "                type: \"S7F71\", item: { //replace with Stream and function intended",
          "",
          "                    type: \"L\", value: [",
          "                        { type: \"A\", value: service }, //data id",
          "                        { type: \"A\", value: message[x] }, //OBJSpec",
          "                        { type: \"A\", value: timeout }, //RCMD",
          "                    ]",
          "                }",
          "            }",
          "",
          "            const reply = await this.framework.driver.sendRaw(\"connect.iot.driver.secsgem.sendMessage\", sendMessage);",
          "            let successFound = false;",
          "            for (const successCode of remoteCommandSuccessCode.split(\",\")) {",
          "                if (reply === successCode.trim()) {",
          "                    successFound = true;",
          "                }",
          "            }",
          "",
          "            // emit output during execution: outputs.output1.emit(\"something\");",
          "            // return example: return { output1: inputs.input1, output2: \"Hello World\" };",
          "        }",
          "    }",
          "}"
        ],
        "jsCodeBase64": "T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsNCmNsYXNzIGRlZmF1bHRfMSB7DQogICAgY29uc3RydWN0b3IoZnJhbWV3b3JrKSB7DQogICAgICAgIHRoaXMuZnJhbWV3b3JrID0gZnJhbWV3b3JrOw0KICAgIH0NCiAgICAvKg0KICAgICAqIEVudHJ5IHBvaW50IG9mIHRoZSBjbGFzcyAoSU1QT1JUQU5UOiBkb24ndCBjaGFuZ2UgdGhlIHNpZ25hdHVyZSBvZiB0aGlzIG1ldGhvZCkNCiAgICAgKiBTaG91bGQgcmV0dXJuIGFuIG9iamVjdCBjb250YWluaW5nIHRoZSB2YWx1ZXMgZm9yIGVhY2ggb3V0cHV0IHRvIGVtaXQNCiAgICAgKiBJZiBuZWNlc3NhcnksIHVzZSB0aGUgcGFyYW1ldGVyICJvdXRwdXRzIiB0byBlbWl0IGRhdGEgd2hpbGUgcnVubmluZyB0aGUgY29kZS4NCiAgICAgKi8NCiAgICBhc3luYyBtYWluKGlucHV0cywgb3V0cHV0cykgew0KICAgICAgICAvL0FkZCBjb2RlIGhlcmUNCiAgICAgICAgY29uc3Qgc2VydmljZSA9IGlucHV0cy5TZXJ2aWNlTmFtZTsNCiAgICAgICAgY29uc3QgdGltZW91dCA9IGlucHV0cy5UaW1lb3V0Ow0KICAgICAgICBjb25zdCBtZXNzYWdlID0gaW5wdXRzLk1lc3NhZ2U7DQogICAgICAgIGxldCB4ID0gMDsNCiAgICAgICAgdGhpcy5mcmFtZXdvcmsubG9nZ2VyLndhcm5pbmcoc2VydmljZSk7DQogICAgICAgIGNvbnN0IHJlbW90ZUNvbW1hbmRTdWNjZXNzQ29kZSA9ICJ0aW1lb3V0PXRydWUiOw0KICAgICAgICBsZXQgY29tbWFuZFBhcmFtZXRlcnMgPSBbXTsNCiAgICAgICAgZm9yICh4ID0gMDsgeCA8IG1lc3NhZ2UubGVuZ3RoOyB4KyspIHsNCiAgICAgICAgICAgIGNvbW1hbmRQYXJhbWV0ZXJzID0gW107DQogICAgICAgICAgICBsZXQgc2VuZE1lc3NhZ2UgPSB7DQogICAgICAgICAgICAgICAgdHlwZTogIlM3RjcxIiwgaXRlbTogew0KICAgICAgICAgICAgICAgICAgICB0eXBlOiAiTCIsIHZhbHVlOiBbDQogICAgICAgICAgICAgICAgICAgICAgICB7IHR5cGU6ICJBIiwgdmFsdWU6IHNlcnZpY2UgfSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHsgdHlwZTogIkEiLCB2YWx1ZTogbWVzc2FnZVt4XSB9LA0KICAgICAgICAgICAgICAgICAgICAgICAgeyB0eXBlOiAiQSIsIHZhbHVlOiB0aW1lb3V0IH0sDQogICAgICAgICAgICAgICAgICAgIF0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9Ow0KICAgICAgICAgICAgY29uc3QgcmVwbHkgPSBhd2FpdCB0aGlzLmZyYW1ld29yay5kcml2ZXIuc2VuZFJhdygiY29ubmVjdC5pb3QuZHJpdmVyLnNlY3NnZW0uc2VuZE1lc3NhZ2UiLCBzZW5kTWVzc2FnZSk7DQogICAgICAgICAgICBsZXQgc3VjY2Vzc0ZvdW5kID0gZmFsc2U7DQogICAgICAgICAgICBmb3IgKGNvbnN0IHN1Y2Nlc3NDb2RlIG9mIHJlbW90ZUNvbW1hbmRTdWNjZXNzQ29kZS5zcGxpdCgiLCIpKSB7DQogICAgICAgICAgICAgICAgaWYgKHJlcGx5ID09PSBzdWNjZXNzQ29kZS50cmltKCkpIHsNCiAgICAgICAgICAgICAgICAgICAgc3VjY2Vzc0ZvdW5kID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICAvLyBlbWl0IG91dHB1dCBkdXJpbmcgZXhlY3V0aW9uOiBvdXRwdXRzLm91dHB1dDEuZW1pdCgic29tZXRoaW5nIik7DQogICAgICAgICAgICAvLyByZXR1cm4gZXhhbXBsZTogcmV0dXJuIHsgb3V0cHV0MTogaW5wdXRzLmlucHV0MSwgb3V0cHV0MjogIkhlbGxvIFdvcmxkIiB9Ow0KICAgICAgICB9DQogICAgfQ0KfQ0KZXhwb3J0cy5kZWZhdWx0ID0gZGVmYXVsdF8xOw0K",
        "inputs": [
          {
            "name": "ServiceName",
            "valueType": {
              "type": 4,
              "collectionType": 0,
              "referenceType": null,
              "referenceTypeName": null,
              "referenceTypeId": null,
              "friendlyName": ""
            },
            "defaultValue": null
          },
          {
            "name": "Message",
            "valueType": {
              "type": 10,
              "collectionType": 0,
              "referenceType": null,
              "referenceTypeName": null,
              "referenceTypeId": null,
              "friendlyName": ""
            },
            "defaultValue": []
          },
          {
            "name": "Timeout",
            "valueType": {
              "type": 4,
              "collectionType": 0,
              "referenceType": null,
              "referenceTypeName": null,
              "referenceTypeId": null,
              "friendlyName": ""
            },
            "defaultValue": null
          }
        ],
        "outputs": [],
        "contextExpirationInMilliseconds": 10000,
        "executionExpirationInMilliseconds": 0,
        "___cmf___name": "Send FDC Data"
      },
      "driver": "SecsGemEquipment"
    },
    {
      "id": "task_145427",
      "reference": {
        "name": "retrieve",
        "package": {
          "name": "@criticalmanufacturing/connect-iot-controller-engine-core-tasks",
          "version": "9.1.0-202209072"
        }
      },
      "settings": {
        "_retrieveOnValueChange": false,
        "_emitInNewContext": false,
        "___cmf___name": "Retrieve Data",
        "_outputs": [
          {
            "name": "Resource",
            "valueType": {
              "type": 4,
              "collectionType": 0,
              "referenceType": null,
              "referenceTypeName": null,
              "referenceTypeId": null,
              "friendlyName": ""
            },
            "identifier": "Generic_ResourceName",
            "defaultValue": " "
          }
        ]
      }
    }
  ],
  "converters": [],
  "links": [
    {
      "id": "task_123433_FDCActionOut-task_123435_FDCActionIn",
      "sourceId": "task_123433",
      "targetId": "task_123435",
      "inputName": "FDCActionIn",
      "outputName": "FDCActionOut",
      "converters": []
    },
    {
      "id": "task_123437_success-task_123431_success",
      "sourceId": "task_123437",
      "targetId": "task_123431",
      "inputName": "success",
      "outputName": "success",
      "converters": []
    },
    {
      "id": "task_123437_error-task_123431_error",
      "sourceId": "task_123437",
      "targetId": "task_123431",
      "inputName": "error",
      "outputName": "error",
      "converters": []
    },
    {
      "id": "task_123435_error-task_123431_error",
      "sourceId": "task_123435",
      "targetId": "task_123431",
      "inputName": "error",
      "outputName": "error",
      "converters": []
    },
    {
      "id": "task_123435_success-task_123437_activate",
      "sourceId": "task_123435",
      "targetId": "task_123437",
      "inputName": "activate",
      "outputName": "success",
      "converters": []
    },
    {
      "id": "task_123435_ServiceNameOut-task_123437_ServiceNameIn",
      "sourceId": "task_123435",
      "targetId": "task_123437",
      "inputName": "ServiceNameIn",
      "outputName": "ServiceNameOut",
      "converters": []
    },
    {
      "id": "task_123435_MessageOut-task_123437_MessageIn",
      "sourceId": "task_123435",
      "targetId": "task_123437",
      "inputName": "MessageIn",
      "outputName": "MessageOut",
      "converters": []
    },
    {
      "id": "task_123435_TimeoutOut-task_123437_TimeoutIn",
      "sourceId": "task_123435",
      "targetId": "task_123437",
      "inputName": "TimeoutIn",
      "outputName": "TimeoutOut",
      "converters": []
    },
    {
      "id": "task_123433_CEIDOut-task_123435_CEIDIn",
      "sourceId": "task_123433",
      "targetId": "task_123435",
      "inputName": "CEIDIn",
      "outputName": "CEIDOut",
      "converters": []
    },
    {
      "id": "task_123433_MaterialNameOut-task_123435_FDCMaterialIn",
      "sourceId": "task_123433",
      "targetId": "task_123435",
      "inputName": "FDCMaterialIn",
      "outputName": "MaterialNameOut",
      "converters": []
    },
    {
      "id": "40e7a502-bfec-4f19-99bf-3740b3baa9db",
      "sourceId": "task_145427",
      "targetId": "task_123435",
      "inputName": "ResourceIn",
      "outputName": "Resource"
    },
    {
      "id": "db03023a-0f9d-4c20-a1ed-37f4e9482636",
      "sourceId": "task_123433",
      "targetId": "task_145427",
      "inputName": "activate",
      "outputName": "activateOut"
    },
    {
      "id": "b68c5ad9-0d56-4974-95c0-3da9679c6de2",
      "sourceId": "task_145427",
      "targetId": "task_123435",
      "inputName": "activate",
      "outputName": "success"
    },
    {
      "id": "f9c2474f-88f2-4bed-982a-35ce681c407e",
      "sourceId": "task_145427",
      "targetId": "task_123431",
      "inputName": "error",
      "outputName": "error"
    }
  ],
  "layout": {
    "general": {
      "color": "#c2adad",
      "notes": []
    },
    "drawers": {
      "DIAGRAM": {
        "tasks": {
          "task_123431": {
            "collapsed": false,
            "position": {
              "x": 2373,
              "y": 384
            },
            "outdated": false
          },
          "task_123433": {
            "collapsed": false,
            "position": {
              "x": 171,
              "y": 384
            },
            "outdated": false
          },
          "task_123435": {
            "collapsed": false,
            "position": {
              "x": 1172,
              "y": 388
            },
            "outdated": false
          },
          "task_123437": {
            "collapsed": false,
            "position": {
              "x": 1771,
              "y": 388
            },
            "outdated": false
          },
          "task_145427": {
            "collapsed": false,
            "position": {
              "x": 661,
              "y": 686
            },
            "outdated": false
          }
        },
        "links": {
          "task_123433_FDCActionOut-task_123435_FDCActionIn": {
            "vertices": []
          },
          "task_123437_success-task_123431_success": {
            "vertices": []
          },
          "task_123437_error-task_123431_error": {
            "vertices": []
          },
          "task_123435_error-task_123431_error": {
            "vertices": [
              {
                "x": 2108,
                "y": 828
              },
              {
                "x": 2287,
                "y": 661
              }
            ]
          },
          "task_123435_success-task_123437_activate": {
            "vertices": []
          },
          "task_123435_ServiceNameOut-task_123437_ServiceNameIn": {
            "vertices": []
          },
          "task_123435_MessageOut-task_123437_MessageIn": {
            "vertices": []
          },
          "task_123435_TimeoutOut-task_123437_TimeoutIn": {
            "vertices": []
          },
          "task_123433_CEIDOut-task_123435_CEIDIn": {
            "vertices": []
          },
          "task_123433_MaterialNameOut-task_123435_FDCMaterialIn": {
            "vertices": []
          },
          "40e7a502-bfec-4f19-99bf-3740b3baa9db": {
            "vertices": []
          },
          "db03023a-0f9d-4c20-a1ed-37f4e9482636": {
            "vertices": []
          },
          "b68c5ad9-0d56-4974-95c0-3da9679c6de2": {
            "vertices": []
          },
          "f9c2474f-88f2-4bed-982a-35ce681c407e": {
            "vertices": [
              {
                "x": 2137,
                "y": 864
              },
              {
                "x": 2335,
                "y": 661
              }
            ]
          }
        },
        "notes": {},
        "zoom": 0.5999999999999996,
        "pan": {
          "x": 102.60000038146973,
          "y": 230.39999389648438
        }
      }
    }
  }
}